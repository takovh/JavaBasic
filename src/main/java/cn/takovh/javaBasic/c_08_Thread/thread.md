并发三大特性
* 可见
* 有序
* 原子

## 原子性

### 线程的原子性

race condition => 竞争条件，指的是多个线程访问共享数据的时候产生竞争

数据的不一致

如何保障数据一致呢？ --> 保障操作的原子性


### 如何保障线程的原子性（上锁）

lock and critical section

持有锁的时候才能进行操作： lock 临界区

保障原子性还可以使用CAS - 无锁/自旋锁/轻量级锁/乐观锁

> 为何叫轻量级 没经过操作系统的调度

重量级：需要经过操作系统老大的管理（悲观锁 lock + 临界区）

轻量级：CAS -> Compare And Swap / Set / Exchange （自旋锁，乐观锁）


CAS的ABA问题解决方案 - Version 或 时间戳

CAS操作本身的原子性保障 - native 的 C++ 实现，使用汇编`lock cmpxchg`指令


### 两种锁的效率

不同的场景：

* 临界区执行时间比较长，等的人很多 -> 使用重量级
* 时间短，等的人少 -> 自旋锁
